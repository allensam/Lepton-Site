//= depend_on_asset "fontsize.html"
'use strict';
// google-analytics
(function(i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r;
  i[r] = i[r] || function() {
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = 1 * new Date();
  a = s.createElement(o),
    m = s.getElementsByTagName(o)[0];
  a.async = 1;
  a.src = g;
  m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-72779894-1', 'auto');
ga('send', 'pageview');

function changeAllFontSizes(value) {
  var binds = document.getElementsByClassName('all-editors-class');
  for (var i = 0; i < binds.length; i++) {
    console.log(binds[i].id)
    document.getElementById(binds[i].id).style.fontSize = value.toString() + 'px';
  }
}
var dependenciesModule = angular.module('dependenciesModule', [])
dependenciesModule.controller('fontSize', ['$scope', function ($scope) {
  $scope.fontSizeValue = 20;
  var fontsize = $scope.fontSizeValue;
  $scope.changeEditorFontSize = function () {
    try {
      changeAllFontSizes($scope.fontSizeValue);
    } catch(e) {
      console.log(e.message)
    }
  }
}]);
dependenciesModule.directive('changeFontSize', [function() {
  return {
    restrict: 'E',
    templateUrl: '<%= asset_path("fontsize.html") %>'
  };
}]);

// initiates javascript module
var javascriptModule = angular.module('javascriptModule', ['dependenciesModule']);
/** controller for this page
 * @param $scope [string] injects angular scope
 * @description confusing crap tbh
 */
javascriptModule.controller('testing', ['$scope', function($scope) {
  $scope.showNewDiv = false;
  $scope.runCode = function(name) {
    var input_error = "$scope." + name + " = 'Error feedback is here!';";
    eval(input_error);
    // creates varible passed is eval to true at the end of
    var passed = false;
    var input = eval(name + ".return_text_in_editor();");
    try {
      eval(input + " passed = true;");
    } catch (e) {
      document.getElementById('style-' + name).style.color = "red";
      var finalMessage = e.message.charAt(0).toUpperCase() + e.message.slice(1);
      eval("$scope." + name + " = " + "'" + finalMessage + ".'" + ";");
    } finally {
      if (passed == true) {
        document.getElementById('style-' + name).style.color = "#aaa";
        eval("$scope." + name + " = 'no Errors! :)';");
      }
    }

  }
}]);


var htmlModule = angular.module('htmlModule', ['dependenciesModule']);
htmlModule.config(['$sceProvider', function($sceProvider) {
  //disables html bind security
  $sceProvider.enabled(false);
}]);

htmlModule.controller('htmlBind', ['$rootScope', '$scope', function($rootScope, $scope) {
  $scope.binderFunction = function(id) {
    var htmlString = "$rootScope." + id + " = " + id + ".return_text_in_editor(); ";
    eval(htmlString)
    }
  controllerStartUpListener();
}]);

// listens for keyup on specific elements
function keyUpEventListener(e) {
  var id = e.getAttribute('id');
  angular.element(document.getElementById('htmlBind')).scope().binderFunction(id);
  angular.element(document.getElementById('htmlBind')).scope().$apply();
}

// inits html bind when controller is fully loaded
function controllerStartUpListener() {
  var ids = [];
  var binds = document.getElementsByClassName('bind-html');
  for (var i = 0; i < binds.length; i++) {
    var id = binds[i].id;
    angular.element(document.getElementById('htmlBind')).scope().binderFunction(id);
  }
}
var bothModules = angular.module("bothModules", ["javascriptModule", "htmlModule"]);

function ngBootstrap() {
  var angularModule = document.getElementById('ng-app');
  var moduleName = angularModule.getAttribute('data-module');
  angular.bootstrap(angularModule, [moduleName]);
};
//listen for events/ window on load
angular.element(document).ready(function() {
  window.addEventListener ?
  window.addEventListener("page:load", ngBootstrap(),false) :
  window.attachEvent && window.attachEvent("page:load", ngBootstrap());
});
